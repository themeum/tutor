// Toast Component
// RTL-aware toast notifications with positioning, stacking, and animations

@use '../mixins' as *;
@use '../mixins/rtl' as rtl;

.tutor-toast-container {
  position: fixed;
  z-index: 1080;
  pointer-events: none;
  
  // Position variants
  &--top-right {
    top: var(--tutor-spacing-6, 16px);
    @include rtl.right(var(--tutor-spacing-6, 16px));
  }
  
  &--top-left {
    top: var(--tutor-spacing-6, 16px);
    @include rtl.left(var(--tutor-spacing-6, 16px));
  }
  
  &--top-center {
    top: var(--tutor-spacing-6, 16px);
    left: 50%;
    transform: translateX(-50%);
  }
  
  &--bottom-right {
    bottom: var(--tutor-spacing-6, 16px);
    @include rtl.right(var(--tutor-spacing-6, 16px));
  }
  
  &--bottom-left {
    bottom: var(--tutor-spacing-6, 16px);
    @include rtl.left(var(--tutor-spacing-6, 16px));
  }
  
  &--bottom-center {
    bottom: var(--tutor-spacing-6, 16px);
    left: 50%;
    transform: translateX(-50%);
  }
  
  // Stacking
  .tutor-toast {
    margin-bottom: var(--tutor-spacing-3, 6px);
    
    &:last-child {
      margin-bottom: 0;
    }
  }
}

.tutor-toast {
  @include tutor-flex(row, flex-start, flex-start);
  min-width: 300px;
  max-width: 400px;
  padding: var(--tutor-spacing-4, 8px);
  background-color: var(--tutor-surface-l1);
  border: 1px solid var(--tutor-border-idle);
  border-radius: 9999px;
  box-shadow: var(--tutor-shadow-lg);
  pointer-events: auto;
  position: relative;
  
  // RTL support
  [dir="rtl"] & {
    flex-direction: row-reverse;
  }
  
  &__icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    @include tutor-flex(row, center, center);
    border-radius: 50%;
    @include rtl.margin-end(var(--tutor-spacing-3, 6px));
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
    
    svg {
      width: 16px;
      height: 16px;
    }
  }
  
  &__content {
    flex: 1;
    min-width: 0;
  }
  
  &__title {
    margin: 0 0 var(--tutor-spacing-1, 2px);
    font-size: var(--tutor-font-size-p1, 16px);
    font-weight: var(--tutor-font-weight-semibold, 600);
    color: var(--tutor-text-primary);
    line-height: var(--tutor-line-height-p1, 22px);
    
    @include rtl.text-align-start();
  }
  
  &__message {
    margin: 0;
    font-size: var(--tutor-font-size-p2, 14px);
    color: var(--tutor-text-secondary);
    line-height: var(--tutor-line-height-p2, 18px);
    
    @include rtl.text-align-start();
  }
  
  &__close {
    position: absolute;
    top: var(--tutor-spacing-2, 4px);
    width: 24px;
    height: 24px;
    padding: 0;
    border: none;
    background: none;
    border-radius: var(--tutor-radius-sm, 4px);
    color: var(--tutor-icon-idle);
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
    
    @include rtl.right(var(--tutor-spacing-2, 4px));
    
    &:hover,
    &:focus {
      background-color: var(--tutor-surface-l2);
      color: var(--tutor-icon-hover);
      outline: none;
    }
    
    .tutor-icon {
      width: 14px;
      height: 14px;
    }
  }
  
  &__actions {
    @include tutor-flex(row, center, flex-end);
    gap: var(--tutor-spacing-2, 4px);
    margin-top: var(--tutor-spacing-3, 6px);
    
    [dir="rtl"] & {
      justify-content: flex-start;
      flex-direction: row-reverse;
    }
  }
  
  // Progress bar for auto-dismiss
  &__progress {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--tutor-surface-l2);
    overflow: hidden;
    
    &-bar {
      height: 100%;
      background-color: var(--tutor-border-brand);
      transition: width linear;
      width: 100%;
      
      &--animate {
        animation: tutor-toast-progress linear forwards;
      }
    }
  }
  
  // Type variants
  &--success {
    border-color: var(--tutor-success);
    
    .tutor-toast__icon {
      color: var(--tutor-success);
      background-color: rgba(var(--tutor-success-rgb, 34, 197, 94), 0.1);
    }
    
    .tutor-toast__progress-bar {
      background-color: var(--tutor-success);
    }
  }
  
  &--warning {
    border-color: var(--tutor-warning);
    
    .tutor-toast__icon {
      color: var(--tutor-warning);
      background-color: rgba(var(--tutor-warning-rgb, 251, 146, 60), 0.1);
    }
    
    .tutor-toast__progress-bar {
      background-color: var(--tutor-warning);
    }
  }
  
  &--error {
    border-color: var(--tutor-error);
    
    .tutor-toast__icon {
      color: var(--tutor-error);
      background-color: rgba(var(--tutor-error-rgb, 239, 68, 68), 0.1);
    }
    
    .tutor-toast__progress-bar {
      background-color: var(--tutor-error);
    }
  }
  
  &--info {
    border-color: var(--tutor-brand-600);
    
    .tutor-toast__icon {
      color: var(--tutor-brand-600);
      background-color: rgba(var(--tutor-brand-600-rgb, 37, 99, 235), 0.1);
    }
    
    .tutor-toast__progress-bar {
      background-color: var(--tutor-brand-600);
    }
  }
  
  // Filled variants
  &--success-filled {
    background-color: var(--tutor-success);
    border-color: var(--tutor-success);
    color: white;
    
    .tutor-toast__title,
    .tutor-toast__message {
      color: white;
    }
    
    .tutor-toast__icon,
    .tutor-toast__close {
      color: white;
    }
    
    .tutor-toast__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  }
  
  &--warning-filled {
    background-color: var(--tutor-warning);
    border-color: var(--tutor-warning);
    color: white;
    
    .tutor-toast__title,
    .tutor-toast__message {
      color: white;
    }
    
    .tutor-toast__icon,
    .tutor-toast__close {
      color: white;
    }
    
    .tutor-toast__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  }
  
  &--error-filled {
    background-color: var(--tutor-error);
    border-color: var(--tutor-error);
    color: white;
    
    .tutor-toast__title,
    .tutor-toast__message {
      color: white;
    }
    
    .tutor-toast__icon,
    .tutor-toast__close {
      color: white;
    }
    
    .tutor-toast__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  }
  
  &--info-filled {
    background-color: var(--tutor-brand-600);
    border-color: var(--tutor-brand-600);
    color: white;
    
    .tutor-toast__title,
    .tutor-toast__message {
      color: white;
    }
    
    .tutor-toast__icon,
    .tutor-toast__close {
      color: white;
    }
    
    .tutor-toast__close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  }
}

// Animation classes for Alpine.js
.tutor-toast {
  &[x-cloak] {
    display: none !important;
  }
  
  // Slide in from right (for right-positioned toasts)
  &.tutor-toast-enter-right {
    opacity: 0;
    transform: translateX(100%);
  }
  
  &.tutor-toast-enter-active-right {
    opacity: 1;
    transform: translateX(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  &.tutor-toast-leave-right {
    opacity: 1;
    transform: translateX(0);
  }
  
  &.tutor-toast-leave-active-right {
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.25s ease, transform 0.25s ease;
  }
  
  // Slide in from left (for left-positioned toasts)
  &.tutor-toast-enter-left {
    opacity: 0;
    transform: translateX(-100%);
  }
  
  &.tutor-toast-enter-active-left {
    opacity: 1;
    transform: translateX(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  &.tutor-toast-leave-left {
    opacity: 1;
    transform: translateX(0);
  }
  
  &.tutor-toast-leave-active-left {
    opacity: 0;
    transform: translateX(-100%);
    transition: opacity 0.25s ease, transform 0.25s ease;
  }
  
  // Slide in from top (for top-positioned toasts)
  &.tutor-toast-enter-top {
    opacity: 0;
    transform: translateY(-100%);
  }
  
  &.tutor-toast-enter-active-top {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  &.tutor-toast-leave-top {
    opacity: 1;
    transform: translateY(0);
  }
  
  &.tutor-toast-leave-active-top {
    opacity: 0;
    transform: translateY(-100%);
    transition: opacity 0.25s ease, transform 0.25s ease;
  }
  
  // Slide in from bottom (for bottom-positioned toasts)
  &.tutor-toast-enter-bottom {
    opacity: 0;
    transform: translateY(100%);
  }
  
  &.tutor-toast-enter-active-bottom {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  &.tutor-toast-leave-bottom {
    opacity: 1;
    transform: translateY(0);
  }
  
  &.tutor-toast-leave-active-bottom {
    opacity: 0;
    transform: translateY(100%);
    transition: opacity 0.25s ease, transform 0.25s ease;
  }
}

// Progress bar animation
@keyframes tutor-toast-progress {
  from {
    width: 100%;
  }
  to {
    width: 0%;
  }
}

// Responsive adjustments
@media (max-width: 576px) {
  .tutor-toast-container {
    left: var(--tutor-spacing-4, 8px) !important;
    right: var(--tutor-spacing-4, 8px) !important;
    transform: none !important;
    
    &--top-center,
    &--bottom-center {
      left: var(--tutor-spacing-4, 8px);
      right: var(--tutor-spacing-4, 8px);
    }
  }
  
  .tutor-toast {
    min-width: auto;
    max-width: none;
    width: 100%;
  }
}